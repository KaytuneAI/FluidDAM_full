# å³æ¢¦ AI API ç‰ˆæœ¬å¯¹æ¯”ï¼š3.0 vs 4.0

## ğŸ“Š å›¾ç‰‡ä¼ è¾“æ–¹å¼å¯¹æ¯”

### å³æ¢¦ 3.0ï¼ˆæ—§ç‰ˆæœ¬ï¼Œå·²æ³¨é‡Šï¼‰

**i2iï¼ˆå›¾ç”Ÿå›¾ï¼‰æ¨¡å¼ï¼š**
```javascript
// req_key
req_key: 'jimeng_i2i_v30'  // i2i ä¸“ç”¨

// å›¾ç‰‡å­—æ®µ
requestBody.binary_data_base64 = [finalImageBase64]  // âš ï¸ æ•°ç»„æ ¼å¼
```

**å…³é”®ç‰¹ç‚¹ï¼š**
- âœ… å­—æ®µåï¼š`binary_data_base64`
- âœ… æ ¼å¼ï¼š**æ•°ç»„** `["base64å­—ç¬¦ä¸²"]`
- âœ… req_keyï¼š`jimeng_i2i_v30`ï¼ˆi2i ä¸“ç”¨ï¼‰
- âœ… å°ºå¯¸ï¼šå›ºå®š 1024x1024

---

### å³æ¢¦ 4.0ï¼ˆå½“å‰ä½¿ç”¨ï¼Œå·²éªŒè¯ï¼‰

**i2i å’Œ t2i æ¨¡å¼ï¼š**
```javascript
// req_key
req_key: 'jimeng_t2i_v40'  // i2i å’Œ t2i å…±ç”¨

// å›¾ç‰‡å­—æ®µï¼ˆä»… i2i æ—¶ï¼‰- ä½¿ç”¨æ•°ç»„æ ¼å¼ï¼ˆä¸ 3.0 ä¸€è‡´ï¼‰
requestBody.binary_data_base64 = [finalImageBase64]  // âœ… æ•°ç»„æ ¼å¼
```

**å…³é”®ç‰¹ç‚¹ï¼š**
- âœ… å­—æ®µåï¼š`binary_data_base64`ï¼ˆä¸ 3.0 ä¸€è‡´ï¼‰
- âœ… æ ¼å¼ï¼š**æ•°ç»„** `["base64å­—ç¬¦ä¸²"]`ï¼ˆä¸ 3.0 ä¸€è‡´ï¼‰
- âœ… req_keyï¼š`jimeng_t2i_v40`ï¼ˆi2i å’Œ t2i å…±ç”¨ï¼‰
- âœ… å°ºå¯¸ï¼šæ”¯æŒè‡ªå®šä¹‰ï¼ˆé»˜è®¤ 1024x1024ï¼‰

**æ³¨æ„ï¼š**
- è™½ç„¶å®˜æ–¹æ–‡æ¡£å¯èƒ½æåˆ° `image_base64`ï¼ˆå­—ç¬¦ä¸²æ ¼å¼ï¼‰ï¼Œä½†å®é™…æµ‹è¯•è¯æ˜ `binary_data_base64`ï¼ˆæ•°ç»„æ ¼å¼ï¼‰ä¹Ÿèƒ½æ­£å¸¸å·¥ä½œ
- ä½¿ç”¨æ•°ç»„æ ¼å¼å¯ä»¥ä¿æŒä¸ 3.0 ç‰ˆæœ¬çš„å®Œå…¨å…¼å®¹æ€§

---

## ğŸ” å…³é”®å·®å¼‚æ€»ç»“

| é¡¹ç›® | 3.0 ç‰ˆæœ¬ | 4.0 ç‰ˆæœ¬ï¼ˆåŸå§‹ï¼‰ | 4.0 ç‰ˆæœ¬ï¼ˆå®é™…ï¼‰ | æ˜¯å¦ä¸€è‡´ |
|------|---------|----------------|----------------|---------|
| **req_key (i2i)** | `jimeng_i2i_v30` | `jimeng_t2i_v40` | `jimeng_t2i_v40` | âš ï¸ éƒ¨åˆ†ä¸€è‡´ |
| **req_key (t2i)** | `jimeng_t2i_v40` | `jimeng_t2i_v40` | `jimeng_t2i_v40` | âœ… ä¸€è‡´ |
| **å›¾ç‰‡å­—æ®µå** | `binary_data_base64` | `image_base64` | `binary_data_base64` | âœ… **ä¸€è‡´** |
| **å›¾ç‰‡æ ¼å¼** | `["base64"]` (æ•°ç»„) | `"base64"` (å­—ç¬¦ä¸²) | `["base64"]` (æ•°ç»„) | âœ… **ä¸€è‡´** |
| **å°ºå¯¸æ”¯æŒ** | å›ºå®š 1024x1024 | æ”¯æŒè‡ªå®šä¹‰ | æ”¯æŒè‡ªå®šä¹‰ | âš ï¸ éƒ¨åˆ†ä¸€è‡´ |

### âœ… é‡è¦å‘ç°ï¼ˆå·²éªŒè¯ï¼‰

**4.0 ç‰ˆæœ¬å®é™…ä¸Šä¹Ÿæ”¯æŒæ•°ç»„æ ¼å¼ï¼**

ç»è¿‡å®é™…æµ‹è¯•éªŒè¯ï¼š
- âœ… 4.0 ç‰ˆæœ¬å¯ä»¥ä½¿ç”¨ `binary_data_base64` å­—æ®µï¼ˆæ•°ç»„æ ¼å¼ï¼‰
- âœ… 4.0 ç‰ˆæœ¬å¯ä»¥ä½¿ç”¨ `jimeng_t2i_v40` req_keyï¼ˆi2i å’Œ t2i å…±ç”¨ï¼‰
- âœ… å›¾ç‰‡ä¼ è¾“æ ¼å¼ä¸ 3.0 ç‰ˆæœ¬å®Œå…¨ä¸€è‡´ï¼š`binary_data_base64 = ["base64å­—ç¬¦ä¸²"]`

è¿™æ„å‘³ç€ï¼š
- **3.0 å’Œ 4.0 åœ¨å›¾ç‰‡ä¼ è¾“æ–¹å¼ä¸Šå®Œå…¨ä¸€è‡´**
- ä¸»è¦åŒºåˆ«åœ¨äº req_key ç­–ç•¥ï¼ˆ3.0 çš„ i2i ä½¿ç”¨ `jimeng_i2i_v30`ï¼Œ4.0 ç»Ÿä¸€ä½¿ç”¨ `jimeng_t2i_v40`ï¼‰

---

## âš ï¸ é‡è¦å‘ç°

### 1. å­—æ®µåå®Œå…¨ä¸åŒ
- **3.0**: `binary_data_base64`ï¼ˆæ•°ç»„ï¼‰
- **4.0**: `image_base64`ï¼ˆå­—ç¬¦ä¸²ï¼‰

### 2. æ•°æ®æ ¼å¼å®Œå…¨ä¸åŒ
- **3.0**: å¿…é¡»æ˜¯æ•°ç»„ `["base64å­—ç¬¦ä¸²"]`
- **4.0**: å¿…é¡»æ˜¯å­—ç¬¦ä¸² `"base64å­—ç¬¦ä¸²"`

### 3. req_key ç­–ç•¥ä¸åŒ
- **3.0**: i2i å’Œ t2i ä½¿ç”¨ä¸åŒçš„ req_key
  - i2i: `jimeng_i2i_v30`
  - t2i: `jimeng_t2i_v40`
- **4.0**: i2i å’Œ t2i å…±ç”¨åŒä¸€ä¸ª req_key
  - i2i: `jimeng_t2i_v40`
  - t2i: `jimeng_t2i_v40`
  - åŒºåˆ«ä»…åœ¨äºæ˜¯å¦æœ‰ `image_base64` å­—æ®µ

---

## âœ… å½“å‰å®ç°æ£€æŸ¥

### 4.0 ç‰ˆæœ¬å®ç°ï¼ˆå·²éªŒè¯æˆåŠŸï¼‰

```javascript
// å½“å‰ä»£ç ï¼ˆç¬¬ 1063-1065 è¡Œï¼‰
if (hasImage) {
  // ä½¿ç”¨ binary_data_base64 æ•°ç»„æ ¼å¼ï¼ˆä¸ 3.0 ä¸€è‡´ï¼‰
  requestBody.binary_data_base64 = [finalImageBase64]  // âœ… æ•°ç»„æ ¼å¼
}
```

**éªŒè¯ç»“æœï¼š** âœ… å®Œå…¨æˆåŠŸï¼Œ4.0 ç‰ˆæœ¬æ”¯æŒæ•°ç»„æ ¼å¼

### 3.0 ç‰ˆæœ¬å®ç°ï¼ˆå·²æ³¨é‡Šï¼Œä»…ä¾›å‚è€ƒï¼‰

```javascript
// æ—§ä»£ç ï¼ˆç¬¬ 1767 è¡Œï¼Œå·²æ³¨é‡Šï¼‰
if (hasImage) {
  requestBody.binary_data_base64 = [finalImageBase64]  // âš ï¸ æ•°ç»„æ ¼å¼
}
```

---

## ğŸ¯ ç»“è®º

**4.0 ç‰ˆæœ¬å’Œ 3.0 ç‰ˆæœ¬åœ¨ä¼ è¾“å›¾ç‰‡åˆ°å³æ¢¦ API çš„ç”¨æ³•æ˜¯** âœ… **åŸºæœ¬ä¸€è‡´çš„**ï¼š

1. **å­—æ®µåç›¸åŒ**ï¼šéƒ½ä½¿ç”¨ `binary_data_base64` âœ…
2. **æ•°æ®æ ¼å¼ç›¸åŒ**ï¼šéƒ½ä½¿ç”¨æ•°ç»„æ ¼å¼ `["base64å­—ç¬¦ä¸²"]` âœ…
3. **req_key ç­–ç•¥ä¸åŒ**ï¼š3.0 çš„ i2i ä½¿ç”¨ `jimeng_i2i_v30`ï¼Œ4.0 ç»Ÿä¸€ä½¿ç”¨ `jimeng_t2i_v40` âš ï¸

**å½“å‰å®ç°ï¼ˆå·²éªŒè¯æˆåŠŸï¼‰ï¼š**
- âœ… ä½¿ç”¨ `binary_data_base64` å­—æ®µï¼ˆæ•°ç»„æ ¼å¼ï¼Œä¸ 3.0 ä¸€è‡´ï¼‰
- âœ… ä½¿ç”¨ `jimeng_t2i_v40` req_keyï¼ˆi2i å’Œ t2i å…±ç”¨ï¼‰
- âœ… å›¾ç‰‡ä¼ è¾“æ–¹å¼ä¸ 3.0 ç‰ˆæœ¬å®Œå…¨å…¼å®¹

---

## ğŸ“ å»ºè®®

å¦‚æœå°†æ¥éœ€è¦åŒæ—¶æ”¯æŒ 3.0 å’Œ 4.0 ç‰ˆæœ¬ï¼Œéœ€è¦ï¼š

1. **æ·»åŠ ç‰ˆæœ¬æ£€æµ‹é€»è¾‘**
   ```javascript
   const apiVersion = req.body.apiVersion || '4.0'
   ```

2. **æ ¹æ®ç‰ˆæœ¬é€‰æ‹©ä¸åŒçš„å­—æ®µå’Œæ ¼å¼**
   ```javascript
   if (apiVersion === '3.0') {
     requestBody.binary_data_base64 = [finalImageBase64]  // æ•°ç»„
     requestBody.req_key = isI2I ? 'jimeng_i2i_v30' : 'jimeng_t2i_v40'
   } else {
     requestBody.image_base64 = finalImageBase64  // å­—ç¬¦ä¸²
     requestBody.req_key = 'jimeng_t2i_v40'  // ç»Ÿä¸€
   }
   ```

3. **åœ¨æ–‡æ¡£ä¸­æ˜ç¡®è¯´æ˜ç‰ˆæœ¬å·®å¼‚**

